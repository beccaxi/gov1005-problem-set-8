---
title: "Problem Set 8"
author: "Rebecca Xi"
date: "4/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Here I read in the necessary data. I load the trump_approval_poll from the
# fivethirtyeight package and use the readr package to read in the new tweets
# Rdata file. this repo’s “raw-data” folder.

library(fivethirtyeight)
library(readr)
library(skimr)
library(ggplot2)
library(tidyverse)

poll <- trump_approval_poll
load(file = 'raw-data/tweetsnew.Rdata')
```

## Question 1: Conduct exploratory data analysis

### 1A) Summary Statistics

```{r 1A, echo=FALSE}

# Here I group the tweet data by week and create a "total_tweets" variable,
# recording the number of tweets that week (including retweets). This amounts to
# counting the number of tweets per week and renaming the automatic "n" column
# to the desired "total_tweets". Since all we care about is the tweet count,
# discarding the other variables from the original tweets dataset is fine.

tweets_summarized <- tweets %>% 
  group_by(week) %>% 
  count() %>% 
  rename(total_tweets = n)

# I then use the code from the problem set instructions to create a week
# variable in the other dataset, poll. This is to facilitate joining the
# summarized tweet data to the poll database.

poll$week <- ceiling(
  as.numeric(difftime(poll$end_date, "2017-01-01", units = "days")) / 7
)

# Now I join the tweet data to the poll data using the week variable, using
# left_join with poll listed first. The joined tibble has 4929 observations. I
# also use mutate() to assign total_tweets = 0 for weeks where there aren't any
# tweets in the database, replacing any NAs.

tibble <- poll %>% 
  left_join(tweets_summarized, by = "week") %>% 
  mutate(total_tweets = ifelse(is.na(total_tweets), 0, total_tweets))

# Finally, I print the output of calling skim() on the total_tweets and approve
# variables. These will be the two variables of interest when we move on to
# correlations.

skim(tibble$total_tweets)
skim(tibble$approve)
```


### 1B) Bivariate correlations

```{r 1B, echo=FALSE}

# I want to replicate the plot from the problem set instructions, which displays
# the approval rating vs. the tweet count for each week, colored in by grade. I
# learned out how to use fct_explicit_na from
# https://github.com/tidyverse/forcats/issues/122, in order to make any NA
# values of grade explicit so as to not omit them from the plot. As usual, I
# apply theme_classic() and the appropriate titles and axis labels to describe
# the plot.

plot <- tibble %>% 
  mutate_if(is.factor, fct_explicit_na, na_level = "(Missing)") %>% 
  ggplot(aes(x = total_tweets, y = approve, color = grade)) + 
    geom_point() +
    labs(
      title = "Trump Approval Rating and Number of Tweets",
      subtitle = "Data from fivethirtyeight and Trump Twitter Archive",
      x = "Total Tweets",
      y = "Approval Rating"
    ) +
    theme_classic()
plot

# Here I calculate the correlation coefficient between the approval rating and
# the number of tweets

corr <- tibble %>% 
  summarize(corr = cor(total_tweets, approve))
corr
```

There does not seem to be a strong relationship in either direction between 
tweet activity and approval ratings. This is reflected by the scatterplot.



## Question 2: Run a multivariate regression

### 2A) Using lm()


### 2B) Interpreting results


### 2C) Interaction Variables

### 2D) Estimating Fitted Values


### 2E) Multiple Regression and the Rubin Causal Model


## Question 3: Generalize to many regressions







